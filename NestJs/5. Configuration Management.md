# âš™ï¸ Configuration Management in NestJS (Senior-Level)

If we master this:

* Our app behaves correctly in **dev / staging / prod**
* Secrets stay secure

---

## ğŸ§  First Principle (Senior Mindset)

> **Configuration is NOT code**

* Code = logic
* Config = environment-dependent values

Hardcoding config is a **junior mistake**.

---

## ğŸ§© NestJS Official Way: `@nestjs/config`

ğŸ“˜ Official docs (core reading):
ğŸ‘‰ [https://docs.nestjs.com/techniques/configuration](https://docs.nestjs.com/techniques/configuration)

---

## 1ï¸âƒ£ Installing Config Module

```bash
npm i @nestjs/config
```

---

## 2ï¸âƒ£ Basic Setup (Global Config)

```ts
import { ConfigModule } from '@nestjs/config';

@Module({
  imports: [
    ConfigModule.forRoot({
      isGlobal: true,
    }),
  ],
})
export class AppModule {}
```

Now `ConfigService` is available **everywhere**.

ğŸ“˜ Docs:
ğŸ‘‰ [https://docs.nestjs.com/techniques/configuration#basic-usage](https://docs.nestjs.com/techniques/configuration#basic-usage)

ğŸ’¡ **Senior Rule**

> ConfigModule should usually be **global**

---

## 3ï¸âƒ£ `.env` Files (Environment Separation)

Example:

```env
PORT=3000
DATABASE_URL=postgresql://...
JWT_SECRET=supersecret
```

NestJS loads `.env` automatically.

Multiple environments:

```
.env
.env.development
.env.production
```

```ts
ConfigModule.forRoot({
  envFilePath: `.env.${process.env.NODE_ENV}`,
});
```

ğŸ“˜ Docs:
ğŸ‘‰ [https://docs.nestjs.com/techniques/configuration#custom-env-file-path](https://docs.nestjs.com/techniques/configuration#custom-env-file-path)

ğŸ’¡ **Senior Rule**

> Never commit `.env` to git

---

## 4ï¸âƒ£ Using ConfigService (Correct Way)

```ts
constructor(private config: ConfigService) {}

const port = this.config.get<number>('PORT');
```

With default:

```ts
this.config.get('PORT', 3000);
```

ğŸ“˜ Docs:
ğŸ‘‰ [https://docs.nestjs.com/techniques/configuration#using-the-configservice](https://docs.nestjs.com/techniques/configuration#using-the-configservice)

---

## 5ï¸âƒ£ Typed Configuration (Senior-Level Cleanliness)

Create config file:

```ts
// config/database.config.ts
export default () => ({
  database: {
    url: process.env.DATABASE_URL,
  },
});
```

Register:

```ts
ConfigModule.forRoot({
  load: [databaseConfig],
});
```

Use:

```ts
this.config.get('database.url');
```

ğŸ“˜ Docs:
ğŸ‘‰ [https://docs.nestjs.com/techniques/configuration#custom-configuration-files](https://docs.nestjs.com/techniques/configuration#custom-configuration-files)

ğŸ’¡ **Senior Rule**

> Typed configs prevent runtime bugs

---

## 6ï¸âƒ£ Validation (Non-Negotiable in Production)

Without validation:
âŒ App starts with broken config

With validation:
âœ… App fails fast

```ts
import * as Joi from 'joi';

ConfigModule.forRoot({
  validationSchema: Joi.object({
    PORT: Joi.number().default(3000),
    JWT_SECRET: Joi.string().required(),
  }),
});
```

ğŸ“˜ Docs:
ğŸ‘‰ [https://docs.nestjs.com/techniques/configuration#schema-validation](https://docs.nestjs.com/techniques/configuration#schema-validation)

ğŸ’¡ **Senior Rule**

> Fail fast > fail silently

---

## 7ï¸âƒ£ Configuration per Module (Advanced)

```ts
@Module({
  imports: [
    ConfigModule.forFeature(databaseConfig),
  ],
})
export class DatabaseModule {}
```

Inject:

```ts
this.config.get('database.url');
```

ğŸ“˜ Docs:
ğŸ‘‰ [https://docs.nestjs.com/techniques/configuration#using-within-modules](https://docs.nestjs.com/techniques/configuration#using-within-modules)

---

## 8ï¸âƒ£ Secrets Management (Real World)

âŒ BAD:

```ts
JWT_SECRET = '123456'
```

âœ… GOOD:

* Environment variables
* CI/CD secrets
* Cloud secret managers

NestJS stays **agnostic** here (good design).

ğŸ’¡ **Senior Rule**

> If leaked, how bad is it?
> If answer = â€œvery badâ€, it must be a secret.

---

## ğŸ§  Real Production Example (Auth)

```ts
JwtModule.registerAsync({
  inject: [ConfigService],
  useFactory: (config: ConfigService) => ({
    secret: config.get('JWT_SECRET'),
    signOptions: {
      expiresIn: config.get('JWT_EXPIRES_IN'),
    },
  }),
});
```

ğŸ“˜ Docs:
ğŸ‘‰ [https://docs.nestjs.com/security/authentication](https://docs.nestjs.com/security/authentication)

---

## ğŸš« Common Junior Mistakes

| Mistake                | Why bad         |
| ---------------------- | --------------- |
| Hardcoded secrets      | Security risk   |
| No validation          | Runtime crashes |
| process.env everywhere | Un-testable     |
| One env for all        | Chaos           |

---

## ğŸ§ª Practice (Answer Like a Senior)

1. Why should config be validated at startup?
2. Why is `process.env` usage discouraged directly?
3. Why is ConfigModule often global?
4. How would you handle secrets in production?

